#+STARTUP: show2level
#+OPTIONS: toc:nil
#+TITLE: Streamlined Spacemacs Configuration
#+AUTHOR: Rod Knowlton
#+EMAIL: codelahoma@gmail.com

* Introduction

This is a streamlined, maintainable Spacemacs configuration using literate programming with Org mode and noweb syntax.

The configuration is organized into logical sections for easy navigation and maintenance.

#+begin_src emacs-lisp :noweb no-export :tangle .spacemacs.d/init.el :comments no
  <<preamble>>
  <<dotspacemacs-layers>>
  <<dotspacemacs-init>>
  <<dotspacemacs-user-env>>
  <<dotspacemacs-user-init>>
  <<dotspacemacs-user-load>>
  <<dotspacemacs-user-config>>
  <<the-rest>>
#+end_src

* Noweb Reference Guide

| noweb-ref                 | Behavior                                                         |
|---------------------------+------------------------------------------------------------------|
| config-layers             | Add to =dotspacemacs-configuration-layers= in =dotspacemacs/layers= |
| additional-packages       | Add to =dotspacemacs-additional-packages= in =dotspacemacs/layers= |
| dotspacemacs-themes       | Add to =dotspacemacs-themes= in =dotspacemacs/init=             |
| dotspacemacs-default-font | Add to ~dotspacemacs-default-font~ in ~dotspacemacs/init~       |
| user-init                 | Insert code into ~dotspacemacs/user-init~                       |
| user-config               | Insert code into ~dotspacemacs/user-config~                     |

* Preamble

#+begin_src emacs-lisp :noweb-ref preamble :comments no
  ;; -*- mode: emacs-lisp; lexical-binding: t -*-
  ;; NOTE: DO NOT EDIT THIS FILE DIRECTLY!!!
  ;; This file is autogenerated from ~dotspacemacs.org~
#+end_src

* Startup Configuration

#+begin_src emacs-lisp :noweb-ref user-init
  ;; Prevent native compilation of problematic org files
  (setq native-comp-jit-compilation-deny-list '(".*org-element.*" ".*org-macs.*" ".*org-compat.*"))
  (setq comp-deferred-compilation t)
#+end_src

* Spacemacs Configuration

This function defines layer configuration and package management.

#+begin_src emacs-lisp :noweb no-export  :noweb-ref dotspacemacs-layers
  (defun dotspacemacs/layers ()
    "Layer configuration:
  This function should only modify configuration layer settings."
    ;; Set org directory BEFORE layers load
    (setq gtd-zettel-org-directory (expand-file-name "~/Dropbox/org/"))

    (setq-default
     dotspacemacs-distribution 'spacemacs
     dotspacemacs-enable-lazy-installation 'unused
     dotspacemacs-ask-for-lazy-installation t
     dotspacemacs-configuration-layer-path '()

     ;; List of configuration layers to load
     dotspacemacs-configuration-layers
     '(
       <<config-layers>>
       )

     ;; List of additional packages that will be installed without being wrapped
     ;; in a layer (generally the packages are installed only and should still be
     ;; loaded using load/require/use-package in the user-config section below in
     ;; this file). If you need some configuration for these packages, then
     ;; consider creating a layer. You can also put the configuration in
     ;; `dotspacemacs/user-config'. To use a local version of a package, use the
     ;; `:location' property: '(your-package :location "~/path/to/your-package/")
     ;; Also include the dependencies as they will not be resolved automatically.
     dotspacemacs-additional-packages
     '(
       <<additional-packages>>
       )

     ;; A list of packages that cannot be updated.
     dotspacemacs-frozen-packages '()

     ;; A list of packages that will not be installed and loaded.
     dotspacemacs-excluded-packages '()

     ;; Defines the behaviour of Spacemacs when installing packages.
     ;; Possible values are `used-only', `used-but-keep-unused' and `all'.
     ;; `used-only' installs only explicitly used packages and deletes any unused
     ;; packages as well as their unused dependencies. `used-but-keep-unused'
     ;; installs only the used packages but won't delete unused ones. `all'
     ;; installs *all* packages supported by Spacemacs and never uninstalls them.
     ;; (default is `used-only')
     dotspacemacs-install-packages 'used-only))
#+end_src

** Layers

*** Core Spacemacs Layers

#+begin_src emacs-lisp :noweb-ref config-layers
  ;; Core functionality
  auto-completion
  colors
  emoji
  evil-better-jumper
  helm
  spacemacs-modeline
  spacemacs-org
  spacemacs-navigation
  syntax-checking
  theming
  (treemacs :variables
            treemacs-use-git-mode 'deferred
            treemacs-filewatch-mode t
            treemacs-use-scope-type 'Perspectives)
  osx
#+end_src

*** Programming Languages

#+begin_src emacs-lisp :noweb-ref config-layers
  ;; Python
  (python :variables
          python-fill-column 99
          python-test-runner 'pytest
          python-backend 'lsp
          python-lsp-server 'pyright
          python-formatter 'black
          python-format-on-save t)

  ;; JavaScript
  (javascript :variables
              javascript-backend nil
              javascript-repl 'nodejs
              javascript-fmt-on-save t
              javascript-fmt-tool 'prettier
              node-add-modules-path t)

  ;; TypeScript
  (typescript :variables
              typescript-backend 'tide
              typescript-fmt-tool 'prettier
              typescript-fmt-on-save t
              typescript-linter 'eslint)

  ;; Other languages
  emacs-lisp
  react
#+end_src

*** Writing & Knowledge Management

#+begin_src emacs-lisp :noweb-ref config-layers
  (org :variables
       org-enable-roam-support t
       org-enable-roam-ui t
       org-enable-sticky-header t
       org-enable-transclusion-support t)
  markdown
  html
  mermaid
#+end_src

*** Data & Formats

#+begin_src emacs-lisp :noweb-ref config-layers
  (yaml :variables yaml-enable-lsp t)
  csv
  pdf
#+end_src

*** Development Tools

#+begin_src emacs-lisp :noweb-ref config-layers
  (lsp :variables
       ;; Performance
       lsp-file-watch-threshold 2000
       lsp-log-io nil
       lsp-idle-delay 0.5
       ;; UI
       lsp-navigation 'peek
       lsp-headerline-breadcrumb-enable t
       lsp-headerline-breadcrumb-segments '(path-up-to-project file symbols)
       lsp-lens-enable t
       ;; Diagnostics
       lsp-diagnostics-provider 'flycheck
       lsp-modeline-diagnostics-enable t)

  (tree-sitter :variables
               tree-sitter-syntax-highlight-enable t
               tree-sitter-fold-enable nil
               tree-sitter-fold-indicators-enable nil)

  docker
  git
  (shell :variables
         shell-default-shell 'vterm
         shell-default-term-shell "/bin/zsh"
         shell-default-height 50
         shell-default-position 'right)
#+end_src

*** UI & Navigation

#+begin_src emacs-lisp :noweb-ref config-layers
  elfeed
  helpful
  ibuffer
  (spell-checking :variables spell-checking-enable-by-default nil)
  version-control
#+end_src

*** Email

#+begin_src emacs-lisp :noweb-ref config-layers
  (mu4e :variables
        mu4e-installation-path "/opt/homebrew/share/emacs/site-lisp/mu/mu4e"
        mu4e-enable-notifications t
        mu4e-enable-mode-line t
        mu4e-org-compose-support t)
#+end_src

*** Private Layers

#+begin_src emacs-lisp :noweb-ref config-layers
  rk-layout
  gtd-zettelkasten
#+end_src

** Additional Packages

#+begin_src emacs-lisp :noweb-ref additional-packages
  ;; AI Integration
  gptel  ;; Install from MELPA (quelpa broken with Emacs 30.2)
  (gptel-extensions :location "~/.emacs.d/private/gptel-extensions.el/")

  ;; Essential Tools
  evil-easymotion
  direnv
  editorconfig
  keychain-environment
  yasnippet-snippets

  ;; Org/Writing
  org-roam-bibtex
  org-noter
  org-noter-pdftools
  fold-this

  ;; UI/Theme
  fira-code-mode
  highlight-indent-guides
  ef-themes
  all-the-icons

  ;; Data
  sqlite3
  mermaid-mode
#+end_src

** Appearance & Theming

*** Themes

#+begin_src emacs-lisp :noweb-ref dotspacemacs-themes
  ef-winter           ;; Clean light theme
  leuven              ;; Classic org-mode light
  ef-autumn           ;; Warm dark theme
  hc-zenburn          ;; Low-contrast dark
  gruvbox-dark-hard   ;; Retro dark
#+end_src

*** Fonts

#+begin_src emacs-lisp :noweb-ref dotspacemacs-default-font
  ("FiraCode Nerd Font"
   :size 18.0
   :weight normal
   :width normal)
  ("JetBrainsMono Nerd Font"
   :size 18.0
   :weight normal
   :width normal)
  ("Cascadia Mono NF"
   :size 18.0
   :weight normal
   :width normal)
  ("Hack Nerd Font"
   :size 18.0
   :weight normal
   :width normal)
#+end_src

*** Font Faces & Ligatures

#+begin_src emacs-lisp :noweb-ref user-config
  ;; Fixed-pitch and variable-pitch for org-mode
  (custom-theme-set-faces
   'user
   '(fixed-pitch ((t (:family "FiraMono Nerd Font" :height 1.0))))
   '(variable-pitch ((t (:family "Source Sans Pro" :height 1.1)))))

  ;; Mode-line font adjustment
  (set-face-attribute 'mode-line nil :height 1.08)

  ;; Enable font ligatures
  (with-eval-after-load 'fira-code-mode
    (global-fira-code-mode))
#+end_src

*** Company Box Styling

#+begin_src emacs-lisp :noweb-ref user-config
  (custom-set-faces
   '(company-tooltip-common
     ((t (:inherit company-tooltip :weight bold :underline nil))))
   '(company-tooltip-common-selection
     ((t (:inherit company-tooltip-selection :weight bold :underline nil)))))
#+end_src

*** Org Visual Configuration

#+begin_src emacs-lisp :noweb-ref user-config
  (with-eval-after-load 'org-superstar
    ;; Headline bullets
    (setq org-superstar-headline-bullets-list '("⦿" "⬦" "○" "▷"))

    ;; Item bullets
    (setq org-superstar-item-bullet-alist
          '((?* . ?•)
            (?+ . ?➤)
            (?- . ?•)))

    ;; TODO state bullets (aligned with gtd-zettelkasten: TODO NEXT WAITING | DONE CANCELED)
    (setq org-superstar-special-todo-items t
          org-superstar-remove-leading-stars t
          org-superstar-todo-bullet-alist
          '(("TODO" . ?☐)
            ("NEXT" . ?▶)
            ("WAITING" . ?⏸)
            ("DONE" . ?✓)
            ("CANCELED" . ?✗)))

    (org-superstar-restart))
#+end_src

** Init Configuration (dotspacemacs/init)

This section defines the main dotspacemacs/init function.

#+begin_src emacs-lisp :noweb no-export  :noweb-ref dotspacemacs-init
  (defun dotspacemacs/init ()
    "Initialization:
  This function is called at the very beginning of Spacemacs startup,
  before layer configuration."
    (setq-default
     dotspacemacs-elpa-https t
     dotspacemacs-elpa-timeout 5
     dotspacemacs-gc-cons '(100000000 0.1)
     dotspacemacs-use-spacelpa nil
     dotspacemacs-verify-spacelpa-archives t
     dotspacemacs-check-for-update nil
     dotspacemacs-elpa-subdirectory 'emacs-version
     dotspacemacs-editing-style 'vim
     dotspacemacs-startup-buffer-show-version t
     dotspacemacs-startup-banner 'official
     dotspacemacs-startup-lists '((recents . 5)
                                  (projects . 7))
     dotspacemacs-startup-buffer-responsive t
     dotspacemacs-new-empty-buffer-major-mode 'text-mode
     dotspacemacs-scratch-mode 'text-mode
     dotspacemacs-initial-scratch-message nil

     dotspacemacs-themes '(
                           <<dotspacemacs-themes>>
                           )

     dotspacemacs-mode-line-theme '(spacemacs :separator curve)
     dotspacemacs-colorize-cursor-according-to-state t

     dotspacemacs-default-font '(
                                 <<dotspacemacs-default-font>>
                                 )

     dotspacemacs-leader-key "SPC"
     dotspacemacs-emacs-command-key "SPC"
     dotspacemacs-ex-command-key ":"
     dotspacemacs-emacs-leader-key "M-m"
     dotspacemacs-major-mode-leader-key ","
     dotspacemacs-major-mode-emacs-leader-key "C-M-m"
     dotspacemacs-distinguish-gui-tab nil
     dotspacemacs-default-layout-name "Default"
     dotspacemacs-display-default-layout nil
     dotspacemacs-auto-resume-layouts nil
     dotspacemacs-auto-generate-layout-names nil
     dotspacemacs-large-file-size 1
     dotspacemacs-auto-save-file-location 'cache
     dotspacemacs-max-rollback-slots 5
     dotspacemacs-enable-paste-transient-state nil
     dotspacemacs-which-key-delay 0.4
     dotspacemacs-which-key-position 'bottom
     dotspacemacs-switch-to-buffer-prefers-purpose nil
     dotspacemacs-loading-progress-bar t
     dotspacemacs-fullscreen-at-startup nil
     dotspacemacs-fullscreen-use-non-native nil
     dotspacemacs-maximized-at-startup nil
     dotspacemacs-undecorated-at-startup nil
     dotspacemacs-active-transparency 90
     dotspacemacs-inactive-transparency 90
     dotspacemacs-show-transient-state-title t
     dotspacemacs-show-transient-state-color-guide t
     dotspacemacs-mode-line-unicode-symbols t
     dotspacemacs-smooth-scrolling t
     dotspacemacs-scroll-bar-while-scrolling t
     dotspacemacs-line-numbers nil
     dotspacemacs-folding-method 'evil
     dotspacemacs-smartparens-strict-mode nil
     dotspacemacs-activate-smartparens-mode t
     dotspacemacs-smart-closing-parenthesis nil
     dotspacemacs-highlight-delimiters 'all
     dotspacemacs-enable-server nil
     dotspacemacs-server-socket-dir nil
     dotspacemacs-persistent-server nil
     dotspacemacs-search-tools '("rg" "ag" "pt" "ack" "grep")
     dotspacemacs-frame-title-format "%I@%S"
     dotspacemacs-icon-title-format nil
     dotspacemacs-show-trailing-whitespace t
     dotspacemacs-whitespace-cleanup nil
     dotspacemacs-use-clean-aindent-mode t
     dotspacemacs-use-SPC-as-y nil
     dotspacemacs-swap-number-row nil
     dotspacemacs-zone-out-when-idle nil
     dotspacemacs-pretty-docs nil
     dotspacemacs-home-shorten-agenda-source nil
     dotspacemacs-byte-compile nil))
#+end_src

** User Environment (dotspacemacs/user-env)

#+begin_src emacs-lisp :noweb-ref dotspacemacs-user-env
  (defun dotspacemacs/user-env ()
    "Environment variables setup.
  This function defines the environment variables for your Emacs session.")
#+end_src

** User Init (dotspacemacs/user-init)

#+begin_src emacs-lisp :noweb no-export  :noweb-ref dotspacemacs-user-init
  (defun dotspacemacs/user-init ()
    "Initialization for user code:
  This function is called immediately after `dotspacemacs/init', before layer
  configuration."
    <<user-init>>)
#+end_src

** User Load (dotspacemacs/user-load)

#+begin_src emacs-lisp :noweb-ref dotspacemacs-user-load
  (defun dotspacemacs/user-load ()
    "Library to load while dumping.
  This function is called only while dumping Spacemacs configuration.")
#+end_src

** User Configuration (dotspacemacs/user-config)

#+begin_src emacs-lisp :noweb no-export  :noweb-ref dotspacemacs-user-config
  (defun dotspacemacs/user-config ()
    "Configuration for user code:
  This function is called at the very end of Spacemacs startup, after layer
  configuration."
    <<user-config>>)
#+end_src

* User Configuration Sections

** Language-Specific Settings

#+begin_src emacs-lisp :noweb-ref user-config
  ;; Python
  (with-eval-after-load 'flycheck
    (setq flycheck-python-pyright-executable "pyright"))

  (with-eval-after-load 'lsp-mode
    (add-to-list 'lsp-enabled-clients 'ruff-lsp))

  ;; JavaScript/TypeScript
  (setq js2-strict-missing-semi-warning nil)

  ;; XML folding
  (add-hook 'nxml-mode-hook #'(lambda() (hs-minor-mode 1)))
  (add-to-list 'hs-special-modes-alist
               '(nxml-mode
                 "<!--\\|<[^/>]*[^/]>"
                 "-->\\|</[^/>]*[^/]>"
                 "<!--"
                 nxml-forward-element
                 nil))
#+end_src

** Tool Configuration

#+begin_src emacs-lisp :noweb-ref user-config
  ;; Helm
  (setq helm-ag-use-grep-ignore-list nil)

  ;; Projectile
  (setq projectile-globally-ignored-directories
        '(".git" "node_modules" "__pycache__" ".pytest_cache"))

  ;; Dired
  (setq dired-listing-switches "-alh")

  ;; Direnv
  (with-eval-after-load 'direnv
    (direnv-mode))

  ;; Backup settings
  (setq backup-directory-alist
        `(("." . ,(concat user-emacs-directory "backups"))))
  (setq create-lockfiles nil)

  ;; Browse URL - use system handler (routes through Hammerspoon URLDispatcher)
  (setq browse-url-browser-function 'browse-url-default-macosx-browser)
#+end_src

** gptel Configuration (AI Integration)

#+begin_src emacs-lisp :noweb-ref user-config
  (use-package gptel
    :after org
    :config
    ;; API Key Management - Use authinfo (built-in support)
    ;; Add to ~/.authinfo: machine api.openai.com login apikey password sk-your-key-here

    ;; Default mode and model
    (setq gptel-default-mode 'org-mode
          gptel-model "gpt-4")

    ;; Enable streaming for better UX
    (setq gptel-stream t)

    ;; Tool/Function calling support
    (setq gptel-use-tools t
          gptel-confirm-tool-calls 'always
          gptel-include-tool-results 'auto)

    ;; Org-mode specific features
    (setq gptel-org-branching-context t)

    ;; Response handling - auto-fill paragraphs
    (add-hook 'gptel-post-response-functions 'gptel-end-of-response)
    (add-hook 'gptel-post-response-functions
              (lambda (_) (fill-region (point-min) (point-max))))

    ;; Useful presets
    (gptel-make-preset "code-review"
      :system "You are a code reviewer. Provide constructive feedback on code quality, \
best practices, potential bugs, and improvements. Be specific and actionable."
      :model "gpt-4")

    (gptel-make-preset "writing-assistant"
      :system "You are a writing assistant. Help improve clarity, grammar, style, and \
structure. Maintain the author's voice while suggesting improvements."
      :model "gpt-4")

    (gptel-make-preset "quick-questions"
      :system "Answer concisely and directly. Provide code examples when relevant."
      :model "gpt-4o-mini")

    ;; Keybindings
    (spacemacs/set-leader-keys
      "ag" 'gptel
      "as" 'gptel-send
      "ar" 'gptel-rewrite
      "am" 'gptel-menu))

  ;; Load gptel-extensions if available
  (when (file-exists-p "~/.emacs.d/private/gptel-extensions.el/gptel-extensions.el")
    (require 'gptel-extensions))
#+end_src

** mu4e Email Configuration

#+begin_src emacs-lisp :noweb-ref user-config
  (with-eval-after-load 'mu4e
    ;; Basic paths
    (setq mu4e-maildir "~/Mail"
          mu4e-attachment-dir "~/Downloads"
          mu4e-get-mail-command "mbsync -a"
          mu4e-update-interval 300)

    ;; Folders (customize per email provider)
    (setq mu4e-sent-folder   "/Sent"
          mu4e-drafts-folder "/Drafts"
          mu4e-trash-folder  "/Trash"
          mu4e-refile-folder "/Archive")

    ;; SMTP (restore from backup or configure manually)
    (setq message-send-mail-function 'smtpmail-send-it
          smtpmail-smtp-server "smtp.example.com"  ; Update with actual server
          smtpmail-smtp-service 587
          smtpmail-stream-type 'starttls)

    ;; View settings
    (setq mu4e-view-show-images t
          mu4e-view-show-addresses t
          mu4e-html2text-command "w3m -T text/html"
          mu4e-compose-format-flowed t))
#+end_src

** Custom Functions

#+begin_src emacs-lisp :noweb-ref user-config
  ;; Claude AI integration
  (defun rk/clip-for-claude ()
    "Copy file path and content with line numbers for Claude AI"
    (interactive)
    (let* ((file-path (buffer-file-name))
           (file-name (file-name-nondirectory file-path))
           (start (if (use-region-p) (region-beginning) (point-min)))
           (end (if (use-region-p) (region-end) (point-max)))
           (start-line (line-number-at-pos start))
           (end-line (line-number-at-pos end))
           (content (buffer-substring-no-properties start end))
           (lines (split-string content "\n"))
           (numbered-lines (mapcar (lambda (line)
                                     (prog1 (format "%4d: %s" start-line line)
                                       (setq start-line (1+ start-line))))
                                   lines))
           (output (concat file-path ":\n"
                          (mapconcat 'identity numbered-lines "\n"))))
      (kill-new output)
      (message "Copied %d lines to clipboard with line numbers" (length lines))))

  ;; Markdown preview with impatient-mode
  (defun markdown-html (buffer)
    "Convert markdown buffer to HTML for preview"
    (princ (with-current-buffer buffer
             (format "<!DOCTYPE html><html><title>Impatient Markdown</title><xmp theme=\"united\" style=\"display:none;\"> %s  </xmp><script src=\"http://strapdownjs.com/v/0.2/strapdown.js\"></script></html>"
                     (buffer-substring-no-properties (point-min) (point-max))))
           (current-buffer)))

  (defun markdown-preview-like-god ()
    "Live markdown preview in browser"
    (interactive)
    (impatient-mode 1)
    (setq imp-user-filter #'markdown-html)
    (cl-incf imp-last-state)
    (imp--notify-clients))

  ;; Utility functions
  (defun my-info-mode-hook ()
    "Info mode navigation enhancements"
    (define-key Info-mode-map (kbd "b") 'Info-history-back)
    (define-key Info-mode-map (kbd "f") 'Info-history-forward))

  (add-hook 'Info-mode-hook 'my-info-mode-hook)

  (defun renumber-region (start end)
    "Renumber list items in region"
    (interactive "r")
    (save-excursion
      (goto-char start)
      (let ((count 1))
        (while (re-search-forward "^[0-9]+\\." end t)
          (replace-match (format "%d." count))
          (setq count (1+ count))))))

  (defun codelahoma/insert-random-uid ()
    "Insert random UUID"
    (interactive)
    (insert (shell-command-to-string "uuidgen | tr '[:upper:]' '[:lower:]' | tr -d '\n'")))

  ;; RSS integration
  (defun elfeed-save-to-org-roam-dailies ()
    "Save elfeed entry to org-roam daily note"
    (interactive)
    (let* ((entry (elfeed-search-selected :single))
           (title (elfeed-entry-title entry))
           (url (elfeed-entry-link entry))
           (date (format-time-string "%Y-%m-%d")))
      (org-roam-dailies-capture-today nil "e")
      (insert (format "* [[%s][%s]]\n" url title))))
#+end_src

** Keybindings

#+begin_src emacs-lisp :noweb-ref user-config
  ;; User-defined prefix
  (spacemacs/declare-prefix "o" "user-defined")

  ;; Buffer operations
  (spacemacs/declare-prefix "ob" "buffer")
  (spacemacs/set-leader-keys "obn" 'spacemacs/new-empty-buffer)

  ;; Copy operations
  (spacemacs/declare-prefix "oc" "copy")
  (spacemacs/set-leader-keys
    "ocl" 'avy-copy-line
    "ocp" 'forge-copy-url-at-point-as-kill)

  ;; Text operations
  (spacemacs/declare-prefix "ox" "text")
  (spacemacs/set-leader-keys "oxw" 'white-space-cleanup)

  ;; Claude AI
  (spacemacs/declare-prefix "oC" "Claude")
  (spacemacs/set-leader-keys "oCC" 'rk/clip-for-claude)

  ;; Folding
  (spacemacs/declare-prefix "of" "folding")
  (spacemacs/set-leader-keys
    "off" 'fold-this
    "ofm" 'fold-this-all
    "ofr" 'fold-this-unfold-all)

  ;; GTD-Zettelkasten (populated by layer)
  (spacemacs/declare-prefix "og" "GTD-Zettelkasten")
#+end_src

* Org-Mode Configuration

** Org Root Directory

#+begin_src emacs-lisp :noweb-ref user-init
  ;; Set org files root directory (all org paths built from this)
  ;; Defined in user-init so it's available before packages load
  (defvar my-org-root-directory (expand-file-name "~/Dropbox/org/")
    "Root directory for all org-mode files. Change this single variable to relocate everything.")
#+end_src

** GTD-Zettelkasten Integration

The gtd-zettel-org-directory is set in dotspacemacs/layers (before layers load).
The layer automatically configures subdirectories:
- gtd-zettel-gtd-directory      → ${gtd-zettel-org-directory}/gtd/
- gtd-zettel-notes-directory    → ${gtd-zettel-org-directory}/notes/
- gtd-zettel-inbox-file         → ${gtd-zettel-org-directory}/gtd/inbox.org
- gtd-zettel-projects-file      → ${gtd-zettel-org-directory}/gtd/projects.org
- TODO keywords: TODO NEXT WAITING | DONE CANCELED

** Org-Roam Settings

#+begin_src emacs-lisp :noweb-ref user-config
  (use-package org-roam
    :custom
    (org-roam-directory (expand-file-name "knowledge/" my-org-root-directory))
    (org-roam-db-location (expand-file-name ".org-roam.db" my-org-root-directory))
    (org-roam-completion-everywhere t)
    :config
    (setq org-roam-node-display-template
          (concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))

    ;; Manual sync workflow (DO NOT enable autosync - causes 100% CPU hang)
    ;; Run M-x org-roam-db-sync after adding/modifying notes
    (add-hook 'kill-emacs-hook 'org-roam-db-sync)

    ;; Optional: Add file exclusions for performance
    (setq org-roam-file-exclude-regexp
          (list "data/" "archive/" ".sync-conflict"))

    ;; Capture templates
    (setq org-roam-capture-templates
          '(("d" "default" plain "%?"
             :target (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
                                "#+title: ${title}\n#+created: %U\n#+filetags: \n\n")
             :unnarrowed t)
            ("p" "permanent" plain "%?"
             :target (file+head "permanent/%<%Y%m%d%H%M%S>-${slug}.org"
                                "#+title: ${title}\n#+created: %U\n#+type: permanent\n#+filetags: \n\n")
             :unnarrowed t)
            ("l" "literature" plain "%?"
             :target (file+head "literature/%<%Y%m%d%H%M%S>-${slug}.org"
                                "#+title: ${title}\n#+author: %^{Author}\n#+created: %U\n#+type: literature\n#+filetags: \n\n")
             :unnarrowed t))))
#+end_src

* The Rest

#+begin_src emacs-lisp :noweb-ref the-rest
  ;; Do not write anything past this comment. This is where Emacs will
  ;; auto-generate custom variable definitions.
  (defun dotspacemacs/emacs-custom-settings ()
    "Emacs custom settings.
  This is an auto-generated function, do not modify its content directly, use
  Emacs customize menu instead.
  This function is called at the very end of Spacemacs initialization."
    )
#+end_src
