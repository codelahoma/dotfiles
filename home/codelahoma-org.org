#+TITLE: GTD System Implementation
#+AUTHOR: Rod
#+PROPERTY: header-args:emacs-lisp :tangle .spacemacs.d/codelahoma-org.el :results silent

* GTD System Overview

This is a comprehensive Getting Things Done (GTD) implementation for Spacemacs using org-babel literate programming. The system is designed to integrate seamlessly with existing Spacemacs patterns while providing a powerful, context-aware productivity workflow.

** Architecture

The GTD system follows a modular component architecture:
- Foundation (100-110): Core setup and engine
- User Interface (120-130): Keybindings and capture
- Workflows (140-160): Processing, reviews, and contexts
- Integration (170-190): External systems and documentation

** Component Loading System

#+begin_src emacs-lisp
;;; codelahoma-gtd.el --- GTD System Implementation -*- lexical-binding: t; -*-

;; Copyright (C) 2025 Rod
;; Author: Rod
;; Version: 1.0.0
;; Package-Requires: ((emacs "27.1") (org "9.6"))

;;; Commentary:
;; A comprehensive GTD implementation for Spacemacs

;;; Code:

(require 'cl-lib)  ; For defstruct

(defgroup codelahoma-gtd nil
  "GTD system configuration."
  :group 'org
  :prefix "codelahoma-gtd-")

(defcustom codelahoma-gtd-directory "~/personal/org-files/gtd/"
  "Base directory for GTD files."
  :type 'directory
  :group 'codelahoma-gtd)

(defvar codelahoma-gtd-components-loaded nil
  "List of loaded GTD components.")

(defun codelahoma-gtd-load-component (component)
  "Load GTD COMPONENT if not already loaded."
  (unless (member component codelahoma-gtd-components-loaded)
    (message "Loading GTD component: %s" component)
    (push component codelahoma-gtd-components-loaded)))
#+end_src

* [100] Foundation Setup

** Development Environment

#+begin_src emacs-lisp
(defun codelahoma-gtd-setup-development ()
  "Set up GTD development environment."
  (interactive)
  ;; Ensure org-babel can execute elisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)))
  
  ;; Set up testing framework
  (require 'ert)
  
  (message "GTD development environment ready"))

(codelahoma-gtd-load-component 'foundation-dev)
#+end_src

** Component Architecture

#+begin_src emacs-lisp
(defvar codelahoma-gtd-components
  '((100 . foundation-setup)
    (110 . core-engine)
    (120 . keybinding-system)
    (130 . capture-system)
    (140 . processing-workflow)
    (150 . review-system)
    (160 . context-engine)
    (170 . integration-layer)
    (180 . testing-framework)
    (190 . documentation))
  "GTD component registry.")

(defun codelahoma-gtd-initialize ()
  "Initialize the GTD system."
  (interactive)
  ;; Create directory structure
  (codelahoma-gtd-create-directories)
  ;; Load core components
  (codelahoma-gtd-load-component 'foundation-setup)
  (codelahoma-gtd-load-component 'core-engine)
  (message "GTD system initialized"))
#+end_src

** File Organization

#+begin_src emacs-lisp
(defvar codelahoma-gtd-files
  '(("inbox.org" . "Inbox")
    ("projects.org" . "Projects") 
    ("next-actions.org" . "Next Actions")
    ("waiting-for.org" . "Waiting For")
    ("someday-maybe.org" . "Someday/Maybe")
    ("reference.org" . "Reference")
    ("tickler.org" . "Tickler"))
  "GTD file definitions.")

(defun codelahoma-gtd-create-directories ()
  "Create GTD directory structure."
  (make-directory codelahoma-gtd-directory t)
  (make-directory (concat codelahoma-gtd-directory "archive/") t)
  (make-directory (concat codelahoma-gtd-directory "reviews/") t))

(defun codelahoma-gtd-create-files ()
  "Create initial GTD files if they don't exist."
  (dolist (file-def codelahoma-gtd-files)
    (let* ((filename (car file-def))
           (title (cdr file-def))
           (filepath (expand-file-name filename codelahoma-gtd-directory)))
      (unless (file-exists-p filepath)
        (with-temp-buffer
          (insert "#+TITLE: " title "\n")
          (insert "#+FILETAGS: :gtd:\n")
          (insert "#+STARTUP: overview\n\n")
          (write-file filepath))))))

(codelahoma-gtd-load-component 'foundation-files)
#+end_src

* [110] Core GTD Engine

** State Management

#+begin_src emacs-lisp
(defvar codelahoma-gtd-states
  '(("TODO" . (:char ?t :face org-todo))
    ("NEXT" . (:char ?n :face org-warning))
    ("WAITING" . (:char ?w :face org-agenda-dimmed-todo-face))
    ("HOLD" . (:char ?h :face org-agenda-dimmed-todo-face))
    ("DONE" . (:char ?d :face org-done))
    ("CANCELLED" . (:char ?c :face org-done)))
  "GTD task states with properties.")

(defun codelahoma-gtd-setup-states ()
  "Configure org-mode states for GTD."
  (setq org-todo-keywords
        '((sequence "TODO(t)" "NEXT(n)" "WAITING(w@/!)" "HOLD(h@/!)" 
                    "|" "DONE(d!)" "CANCELLED(c@)")))
  
  (setq org-todo-keyword-faces
        (mapcar (lambda (state)
                  (cons (car state) (plist-get (cdr state) :face)))
                codelahoma-gtd-states)))

(codelahoma-gtd-load-component 'core-states)
#+end_src

** File Organization Engine

#+begin_src emacs-lisp
(defun codelahoma-gtd-inbox-file ()
  "Return the inbox file path."
  (expand-file-name "inbox.org" codelahoma-gtd-directory))

(defun codelahoma-gtd-projects-file ()
  "Return the projects file path."
  (expand-file-name "projects.org" codelahoma-gtd-directory))

(defun codelahoma-gtd-file (name)
  "Return the path for GTD file NAME."
  (expand-file-name (concat name ".org") codelahoma-gtd-directory))

(defvar codelahoma-gtd-agenda-files nil
  "List of files to include in agenda.")

(defun codelahoma-gtd-update-agenda-files ()
  "Update the list of agenda files."
  (setq codelahoma-gtd-agenda-files
        (mapcar (lambda (file-def)
                  (expand-file-name (car file-def) codelahoma-gtd-directory))
                codelahoma-gtd-files))
  (setq org-agenda-files codelahoma-gtd-agenda-files))

(codelahoma-gtd-load-component 'core-files)
#+end_src

** Basic Data Structures

#+begin_src emacs-lisp
(cl-defstruct codelahoma-gtd-context
  "GTD context structure."
  name          ; Context name (string)
  key           ; Shortcut key (character)
  predicate     ; Function to test if context applies
  face          ; Face for display
  description)  ; Human-readable description

(defvar codelahoma-gtd-contexts nil
  "List of defined GTD contexts.")

(defun codelahoma-gtd-define-context (name key predicate &optional face description)
  "Define a new GTD context."
  (let ((context (make-codelahoma-gtd-context
                  :name name
                  :key key
                  :predicate predicate
                  :face (or face 'default)
                  :description (or description name))))
    (add-to-list 'codelahoma-gtd-contexts context)))

(codelahoma-gtd-load-component 'core-structures)
#+end_src

* [120] Keybinding System

** SPC o o Hierarchy

#+begin_src emacs-lisp
(defvar codelahoma-gtd-keymap (make-sparse-keymap)
  "Keymap for GTD commands.")

(defun codelahoma-gtd-setup-keybindings ()
  "Set up GTD keybindings in Spacemacs."
  ;; Global GTD prefix (available everywhere)
  (spacemacs/declare-prefix "oo" "GTD")
  
  ;; Capture (available everywhere)
  (spacemacs/declare-prefix "ooc" "capture")
  (spacemacs/set-leader-keys "oocc" 'org-capture)
  (spacemacs/set-leader-keys "ooci" 'codelahoma-gtd-capture-inbox)
  (spacemacs/set-leader-keys "oocp" 'codelahoma-gtd-capture-project)
  
  ;; Process (available everywhere)
  (spacemacs/declare-prefix "oop" "process")
  (spacemacs/set-leader-keys "oopi" 'codelahoma-gtd-process-inbox)
  (spacemacs/set-leader-keys "oopc" 'codelahoma-gtd-clarify-item)
  
  ;; Review (available everywhere)
  (spacemacs/declare-prefix "oor" "review")
  (spacemacs/set-leader-keys "oord" 'codelahoma-gtd-daily-review)
  (spacemacs/set-leader-keys "oorw" 'codelahoma-gtd-weekly-review)
  
  ;; Navigate (available everywhere)
  (spacemacs/declare-prefix "oon" "navigate")
  (spacemacs/set-leader-keys "ooni" 'codelahoma-gtd-open-inbox)
  (spacemacs/set-leader-keys "oonp" 'codelahoma-gtd-open-projects)
  (spacemacs/set-leader-keys "oonn" 'codelahoma-gtd-open-next-actions))

(codelahoma-gtd-load-component 'keybindings)
#+end_src

** Which-key Integration

#+begin_src emacs-lisp
(defun codelahoma-gtd-setup-which-key ()
  "Configure which-key descriptions for GTD."
  (which-key-add-key-based-replacements
    "SPC o o" "GTD"
    "SPC o o c" "capture"
    "SPC o o c c" "generic capture"
    "SPC o o c i" "inbox item"
    "SPC o o c p" "project"
    "SPC o o p" "process"
    "SPC o o p i" "inbox"
    "SPC o o p c" "clarify"
    "SPC o o r" "review"
    "SPC o o r d" "daily"
    "SPC o o r w" "weekly"
    "SPC o o n" "navigate"
    "SPC o o n i" "inbox"
    "SPC o o n p" "projects"
    "SPC o o n n" "next actions"))

(with-eval-after-load 'which-key
  (codelahoma-gtd-setup-which-key))

(codelahoma-gtd-load-component 'which-key)
#+end_src

* [130] Capture System

** Context Detection

#+begin_src emacs-lisp
(defun codelahoma-gtd-detect-context ()
  "Detect current context for smart capture."
  (cond
   ;; In a project file
   ((and (buffer-file-name)
         (string-match-p "projects" (buffer-file-name)))
    'project)
   ;; In a code file
   ((derived-mode-p 'prog-mode)
    'code)
   ;; In an email
   ((or (derived-mode-p 'message-mode)
        (derived-mode-p 'mail-mode))
    'email)
   ;; Default
   (t 'general)))

(defun codelahoma-gtd-capture-template-for-context (context)
  "Return capture template based on CONTEXT."
  (pcase context
    ('project "* TODO %?\n  :PROPERTIES:\n  :CREATED: %U\n  :END:\n  %a")
    ('code "* TODO %? :code:\n  :PROPERTIES:\n  :CREATED: %U\n  :FILE: %F\n  :END:\n  %a")
    ('email "* TODO %? :email:\n  :PROPERTIES:\n  :CREATED: %U\n  :FROM: %:from\n  :END:\n  %a")
    (_ "* TODO %?\n  :PROPERTIES:\n  :CREATED: %U\n  :END:\n  %i")))

(codelahoma-gtd-load-component 'capture-context)
#+end_src

** Template Management

#+begin_src emacs-lisp
(defvar codelahoma-gtd-capture-templates
  '(("i" "Inbox" entry (file codelahoma-gtd-inbox-file)
     "* TODO %?\n  :PROPERTIES:\n  :CREATED: %U\n  :END:\n  %i")
    ("p" "Project" entry (file codelahoma-gtd-projects-file)
     "* TODO %? [/]\n  :PROPERTIES:\n  :CREATED: %U\n  :END:\n** TODO First task")
    ("n" "Next Action" entry (file codelahoma-gtd-file "next-actions")
     "* NEXT %?\n  :PROPERTIES:\n  :CREATED: %U\n  :CONTEXT: %^{Context|@home|@office|@errands|@calls|@computer}\n  :END:")
    ("w" "Waiting For" entry (file codelahoma-gtd-file "waiting-for")
     "* WAITING %? :waiting:\n  :PROPERTIES:\n  :CREATED: %U\n  :WAITING_ON: %^{Waiting on}\n  :END:"))
  "GTD capture templates.")

(defun codelahoma-gtd-setup-capture-templates ()
  "Configure org-capture templates for GTD."
  (setq org-capture-templates codelahoma-gtd-capture-templates))

(defun codelahoma-gtd-capture-inbox ()
  "Quick capture to inbox."
  (interactive)
  (org-capture nil "i"))

(defun codelahoma-gtd-capture-project ()
  "Capture a new project."
  (interactive)
  (org-capture nil "p"))

(codelahoma-gtd-load-component 'capture-templates)
#+end_src

* [140] Processing Workflow

** Two-minute Rule

#+begin_src emacs-lisp
(defvar codelahoma-gtd-two-minute-threshold 120
  "Threshold in seconds for two-minute rule.")

(defun codelahoma-gtd-apply-two-minute-rule ()
  "Apply two-minute rule to current item."
  (interactive)
  (let ((start-time (current-time)))
    (when (y-or-n-p "Can this be done in 2 minutes? ")
      (message "Timer started. Press C-c C-c when done.")
      (add-hook 'org-ctrl-c-ctrl-c-final-hook
                (lambda ()
                  (let ((elapsed (time-subtract (current-time) start-time)))
                    (message "Task completed in %s seconds"
                             (time-to-seconds elapsed)))
                  (org-todo "DONE")
                  (remove-hook 'org-ctrl-c-ctrl-c-final-hook
                               'codelahoma-gtd-two-minute-timer))))))

(codelahoma-gtd-load-component 'two-minute-rule)
#+end_src

** Inbox Processing

#+begin_src emacs-lisp
(defun codelahoma-gtd-process-inbox ()
  "Process items in the inbox."
  (interactive)
  (find-file (codelahoma-gtd-inbox-file))
  (goto-char (point-min))
  (org-next-visible-heading 1)
  (codelahoma-gtd-process-current-item))

(defun codelahoma-gtd-process-current-item ()
  "Process the current inbox item."
  (interactive)
  (when (org-at-heading-p)
    (org-narrow-to-subtree)
    (let ((choice (read-char-choice
                   "Process: [d]o now, [p]roject, [n]ext action, [w]aiting, [s]omeday, [r]eference, [t]rash: "
                   '(?d ?p ?n ?w ?s ?r ?t))))
      (pcase choice
        (?d (codelahoma-gtd-apply-two-minute-rule))
        (?p (codelahoma-gtd-convert-to-project))
        (?n (codelahoma-gtd-file-as-next-action))
        (?w (codelahoma-gtd-file-as-waiting))
        (?s (codelahoma-gtd-file-as-someday))
        (?r (codelahoma-gtd-file-as-reference))
        (?t (org-cut-subtree)))
      (widen)
      (when (and (not (eobp)) (org-at-heading-p))
        (when (y-or-n-p "Process next item? ")
          (codelahoma-gtd-process-current-item))))))

(codelahoma-gtd-load-component 'inbox-processing)
#+end_src

* [150] Review System

** Daily Reviews

#+begin_src emacs-lisp
(defvar codelahoma-gtd-daily-review-template
  '("Daily Review - %t"
    "* Review Outcomes"
    "** What got done today?"
    "** What didn't get done?"
    "** What came up?"
    "* Process Inbox"
    "  - [ ] Clear email inbox"
    "  - [ ] Clear GTD inbox"
    "* Review Calendar"
    "  - [ ] Review today's appointments"
    "  - [ ] Review tomorrow's appointments"
    "* Review Next Actions"
    "  - [ ] Mark completed items DONE"
    "  - [ ] Select tomorrow's priorities")
  "Template for daily reviews.")

(defun codelahoma-gtd-daily-review ()
  "Conduct daily GTD review."
  (interactive)
  (let ((review-file (expand-file-name
                      (format-time-string "reviews/daily-%Y%m%d.org")
                      codelahoma-gtd-directory)))
    (find-file review-file)
    (when (= (buffer-size) 0)
      (dolist (line codelahoma-gtd-daily-review-template)
        (insert (format-time-string line) "\n"))
      (goto-char (point-min))
      (org-next-visible-heading 1))))

(codelahoma-gtd-load-component 'daily-reviews)
#+end_src

** Weekly Reviews

#+begin_src emacs-lisp
(defvar codelahoma-gtd-weekly-review-template
  '("Weekly Review - Week %V, %Y"
    "* Get Clear"
    "** Collect Loose Papers and Materials"
    "** Get \"In\" to Zero"
    "   - [ ] Process all inboxes"
    "** Empty Your Head"
    "   - [ ] Write down any uncaptured items"
    "* Get Current" 
    "** Review Action Lists"
    "   - [ ] Mark off completed actions"
    "   - [ ] Review for reminders of further action steps"
    "** Review Previous Calendar Data"
    "   - [ ] Transfer relevant info to project plans"
    "** Review Upcoming Calendar"
    "   - [ ] Capture actions from meetings"
    "** Review Waiting For List"
    "   - [ ] Check off received items"
    "   - [ ] Follow up on pending items"
    "** Review Project List"
    "   - [ ] Ensure each project has a next action"
    "   - [ ] Review project plans"
    "** Review Someday/Maybe List"
    "   - [ ] Move to projects if ready"
    "   - [ ] Delete items no longer of interest"
    "* Get Creative"
    "** Any new projects?"
    "** Any ideas to capture?")
  "Template for weekly reviews.")

(defun codelahoma-gtd-weekly-review ()
  "Conduct weekly GTD review."
  (interactive)
  (let ((review-file (expand-file-name
                      (format-time-string "reviews/weekly-%Y-W%V.org")
                      codelahoma-gtd-directory)))
    (find-file review-file)
    (when (= (buffer-size) 0)
      (dolist (line codelahoma-gtd-weekly-review-template)
        (insert (format-time-string line) "\n"))
      (goto-char (point-min)))))

(codelahoma-gtd-load-component 'weekly-reviews)
#+end_src

* [160] Context Engine

** Location Contexts

#+begin_src emacs-lisp
(codelahoma-gtd-define-context
 "@home" ?h
 (lambda () (string-match-p "home\\|house" (or (getenv "LOCATION") "")))
 'org-priority-faces
 "Tasks that can be done at home")

(codelahoma-gtd-define-context
 "@office" ?o  
 (lambda () (string-match-p "office\\|work" (or (getenv "LOCATION") "")))
 'org-priority-faces
 "Tasks that can be done at the office")

(codelahoma-gtd-define-context
 "@errands" ?e
 (lambda () t)  ; Always available
 'org-priority-faces
 "Tasks to do while out and about")

(codelahoma-gtd-define-context
 "@computer" ?c
 (lambda () (display-graphic-p))  ; Has display
 'org-priority-faces
 "Tasks requiring a computer")

(codelahoma-gtd-load-component 'location-contexts)
#+end_src

** Energy Contexts

#+begin_src emacs-lisp
(defvar codelahoma-gtd-energy-level 'normal
  "Current energy level: 'high, 'normal, or 'low.")

(codelahoma-gtd-define-context
 ":high-energy" ?H
 (lambda () (eq codelahoma-gtd-energy-level 'high))
 'org-scheduled-today
 "Tasks requiring high energy/focus")

(codelahoma-gtd-define-context
 ":low-energy" ?L
 (lambda () (eq codelahoma-gtd-energy-level 'low))
 'org-agenda-dimmed-todo-face
 "Tasks suitable for low energy")

(defun codelahoma-gtd-set-energy-level (level)
  "Set current energy LEVEL."
  (interactive
   (list (intern (completing-read "Energy level: "
                                  '("high" "normal" "low")))))
  (setq codelahoma-gtd-energy-level level)
  (message "Energy level set to: %s" level))

(codelahoma-gtd-load-component 'energy-contexts)
#+end_src

* [170] Integration Layer

** Org Appearance Configuration

#+begin_src emacs-lisp
;; Org appearance and font faces (moved from dotspacemacs.org)
(with-eval-after-load 'org
  (let ((headline '(:inherit default :weight bold)))
    (custom-theme-set-faces
     'user
     '(fixed-pitch ((t ( :family "FiraMono Nerd Font" :height 1.0))))
     '(variable-pitch ((t (:family "Source Sans Pro" :height 1.1))))
     `(org-document-title ((t (,@headline :inherit fixed-pitch :height 2.5 :underline nil))))
     `(org-level-1 ((t (,@headline :inherit fixed-pitch :height 1.8 ))))
     `(org-level-2 ((t (,@headline :inherit fixed-pitch :height 1.5 ))))
     `(org-level-3 ((t (,@headline :inherit fixed-pitch :height 1.4 ))))
     `(org-level-4 ((t (,@headline :inherit fixed-pitch :height 1.3 ))))
     `(org-level-5 ((t (,@headline :inherit fixed-pitch :height 1.2))))
     `(org-level-6 ((t (,@headline :inherit fixed-pitch :height 1.2))))
     `(org-level-7 ((t (,@headline :inherit fixed-pitch :height 1.2))))
     `(org-level-8 ((t (,@headline :inherit fixed-pitch :height 1.2))))
     '(org-block ((t (:inherit fixed-pitch :height 0.8))))
     '(org-code ((t (:inherit (shadow fixed-pitch)))))
     '(org-date ((t (:inherit (font-lock-comment-face fixed-pitch) :height 0.9))))
     '(org-document-info-keyword ((t (:inherit (shadow fixed-pitch)))))
     '(org-done ((t ( :font "Fira Sans" :height 1.0  :weight bold))))
     '(org-indent ((t (:inherit (org-hide fixed-pitch)))))
     '(org-link ((t (:underline t))))
     '(org-meta-line ((t (:inherit (font-lock-comment-face fixed-pitch)))))
     '(org-property-value ((t (:inherit fixed-pitch))))
     '(org-special-keyword ((t (:inherit (font-lock-comment-face fixed-pitch)))))
     '(org-table ((t (:inherit fixed-pitch ))))
     '(org-tag ((t (:inherit (shadow fixed-pitch)  :height 0.5))))
     '(org-todo ((t ( :font "Fira Sans" :height 0.8 ))))
     '(org-verbatim ((t (:inherit (shadow fixed-pitch)))))
     )))

(codelahoma-gtd-load-component 'org-appearance)
#+end_src

** Org-superstar Configuration

#+begin_src emacs-lisp
;; Org-superstar bullets configuration (moved from dotspacemacs.org)
(with-eval-after-load 'org-superstar
  (setq org-superstar-item-bullet-alist
        '((?* . ?•)
          (?+ . ?➤)
          (?- . ?•)))
  (setq org-superstar-headline-bullets-list
        '("⦿" "⬦" "○" "▷"))
  (setq org-superstar-special-todo-items t)
  (setq org-superstar-remove-leading-stars t)
  ;; Enable custom bullets for TODO items
  (setq org-superstar-todo-bullet-alist
        '(("TODO" . ?🔳)
          ("NEXT" . ?👀)
          ("IN-PROGRESS" . ?🚀)
          ("CODE-COMPLETE" . ?💾)
          ("NEEDS-REFINEMENT" . ?🔍)
          ("WAITING" . ?⏰)
          ("ON-HOLD" . ?⏸)
          ("MEETING" . ?⏰)
          ("CANCELLED" . ?❌)
          ("ATTENDED" . ?📝)
          ("ANSWERED" . ?👍) 
          ("DONE" . ?✅)))
  (org-superstar-restart))

;; Set default bullet scheme
(with-eval-after-load 'org-superstar
  (when (fboundp 'rk/switch-org-bullets)
    (rk/switch-org-bullets "Runes")))

(codelahoma-gtd-load-component 'org-superstar)
#+end_src

** GPTel Integration

#+begin_src emacs-lisp
;; GPTel org-mode integration (moved from dotspacemacs.org)
(with-eval-after-load 'gptel
  (setq gptel-default-mode 'org-mode))

(codelahoma-gtd-load-component 'gptel-integration)
#+end_src

** Elfeed Integration

#+begin_src emacs-lisp
;; Elfeed org integration (moved from dotspacemacs.org)
(with-eval-after-load 'elfeed
  (require 'elfeed)
  
  (defun elfeed-save-to-org-roam-dailies ()
    "Save the current elfeed entry to org-roam dailies."
    (interactive)
    (let* ((entry (elfeed-search-selected :single))
           (title (elfeed-entry-title entry))
           (link (elfeed-entry-link entry))
           (content (elfeed-deref (elfeed-entry-content entry)))
           (date (format-time-string "%Y-%m-%d"))
           (org-roam-dailies-dir (expand-file-name "dailies" org-roam-directory))
           (daily-file (expand-file-name (concat date ".org") org-roam-dailies-dir)))
      (unless (file-exists-p daily-file)
        (with-temp-buffer (write-file daily-file)))
      (with-current-buffer (find-file-noselect daily-file)
        (goto-char (point-max))
        (insert (concat "* " title "\n"))
        (insert (concat "[[" link "][" link "]]\n\n"))
        (insert (concat content "\n"))
        (save-buffer))))

  ;; Bind the function to a key for easy access
  (define-key elfeed-search-mode-map (kbd "o") 'elfeed-save-to-org-roam-dailies))

(codelahoma-gtd-load-component 'elfeed-integration)
#+end_src

** Org Color Theme Integration

#+begin_src emacs-lisp
;; Set default org color scheme
(with-eval-after-load 'org
  (when (fboundp 'switch-org-colors)
    (switch-org-colors "Cyber")))

(codelahoma-gtd-load-component 'org-color-theme)
#+end_src

** Org-roam Integration

#+begin_src emacs-lisp
(defun codelahoma-gtd-link-to-roam ()
  "Link current GTD item to org-roam."
  (interactive)
  (when (fboundp 'org-roam-node-insert)
    (org-roam-node-insert)))

(defun codelahoma-gtd-create-project-note ()
  "Create org-roam note for current project."
  (interactive)
  (when (and (fboundp 'org-roam-capture)
             (org-at-heading-p))
    (let ((project-name (org-get-heading t t t t)))
      (org-roam-capture nil "p"))))

(codelahoma-gtd-load-component 'roam-integration)
#+end_src

** Org-agenda Integration

#+begin_src emacs-lisp
(defun codelahoma-gtd-setup-agenda-views ()
  "Configure org-agenda custom views for GTD."
  (setq org-agenda-custom-commands
        '(("g" "GTD Views"
           ((agenda "" ((org-agenda-span 'day)
                        (org-agenda-start-with-log-mode t)))
            (todo "NEXT" ((org-agenda-overriding-header "Next Actions")))
            (todo "WAITING" ((org-agenda-overriding-header "Waiting For")))
            (todo "TODO" ((org-agenda-overriding-header "Projects")
                          (org-agenda-files (list (codelahoma-gtd-projects-file)))))))
          ("d" "Daily Dashboard"
           ((agenda "" ((org-agenda-span 'day)))
            (todo "NEXT" ((org-agenda-overriding-header "Next Actions")
                          (org-agenda-sorting-strategy '(priority-down effort-up))))
            (todo "WAITING" ((org-agenda-overriding-header "Waiting For")))))
          ("w" "Weekly Review"
           ((agenda "" ((org-agenda-span 'week)))
            (todo "TODO" ((org-agenda-overriding-header "All Open Projects")))
            (todo "WAITING" ((org-agenda-overriding-header "All Waiting Items")))
            (todo "SOMEDAY" ((org-agenda-overriding-header "Someday/Maybe"))))))))

(codelahoma-gtd-load-component 'agenda-integration)
#+end_src

* [180] Testing Framework

** Unit Tests

#+begin_src emacs-lisp
(require 'ert)

(ert-deftest codelahoma-gtd-test-initialization ()
  "Test GTD system initialization."
  (let ((temp-dir (make-temp-file "gtd-test" t)))
    (unwind-protect
        (let ((codelahoma-gtd-directory temp-dir))
          (codelahoma-gtd-create-directories)
          (should (file-exists-p temp-dir))
          (should (file-exists-p (expand-file-name "archive/" temp-dir)))
          (should (file-exists-p (expand-file-name "reviews/" temp-dir))))
      (delete-directory temp-dir t))))

(ert-deftest codelahoma-gtd-test-file-creation ()
  "Test GTD file creation."
  (let ((temp-dir (make-temp-file "gtd-test" t)))
    (unwind-protect
        (let ((codelahoma-gtd-directory temp-dir))
          (codelahoma-gtd-create-files)
          (dolist (file-def codelahoma-gtd-files)
            (should (file-exists-p 
                     (expand-file-name (car file-def) temp-dir)))))
      (delete-directory temp-dir t))))

(ert-deftest codelahoma-gtd-test-context-detection ()
  "Test context detection."
  (let ((codelahoma-gtd-energy-level 'high))
    (should (funcall (codelahoma-gtd-context-predicate
                      (car (cl-member-if (lambda (ctx)
                                           (equal (codelahoma-gtd-context-name ctx)
                                                  ":high-energy"))
                                         codelahoma-gtd-contexts)))))))

(codelahoma-gtd-load-component 'unit-tests)
#+end_src

** Integration Tests

#+begin_src emacs-lisp
(ert-deftest codelahoma-gtd-test-capture-flow ()
  "Test capture workflow integration."
  (let ((temp-dir (make-temp-file "gtd-test" t)))
    (unwind-protect
        (let ((codelahoma-gtd-directory temp-dir)
              (org-capture-templates codelahoma-gtd-capture-templates))
          (codelahoma-gtd-create-files)
          ;; Test would simulate capture here
          (should t))  ; Placeholder
      (delete-directory temp-dir t))))

(defun codelahoma-gtd-run-all-tests ()
  "Run all GTD tests."
  (interactive)
  (ert-run-tests-batch-and-exit "^codelahoma-gtd-test-"))

(codelahoma-gtd-load-component 'integration-tests)
#+end_src

* [190] Documentation

** User Guide

#+begin_src org :tangle no
,* GTD System User Guide

,** Quick Start

1. Initialize the system: M-x codelahoma-gtd-initialize
2. Capture items: SPC o o c i (inbox capture)
3. Process inbox: SPC o o p i
4. Review daily: SPC o o r d

,** Key Bindings

| Key         | Command                | Description           |
|-------------+------------------------+-----------------------|
| SPC o o c i | Capture to inbox       | Quick capture         |
| SPC o o c p | Capture project        | New project           |
| SPC o o p i | Process inbox          | Process inbox items   |
| SPC o o r d | Daily review           | Run daily review      |
| SPC o o r w | Weekly review          | Run weekly review     |
| SPC o o n i | Navigate to inbox      | Open inbox file       |
| SPC o o n p | Navigate to projects   | Open projects file    |

,** Workflow

1. *Capture*: Use SPC o o c i to quickly capture thoughts
2. *Clarify*: Process inbox items into actionable tasks
3. *Organize*: File items into appropriate lists
4. *Review*: Daily and weekly reviews keep system current
5. *Do*: Work from context-filtered next actions
#+end_src

** Migration Tools

#+begin_src emacs-lisp
(defun codelahoma-gtd-migrate-from-old-system ()
  "Migrate from previous GTD system."
  (interactive)
  (when (y-or-n-p "This will migrate your old GTD files. Continue? ")
    (message "Migration would happen here...")
    ;; Implementation would:
    ;; 1. Find old GTD files
    ;; 2. Parse and convert format
    ;; 3. Create new structure
    ;; 4. Preserve data
    ))

(codelahoma-gtd-load-component 'migration-tools)
#+end_src

* Activation

#+begin_src emacs-lisp
;; Ensure all components are loaded
(defun codelahoma-gtd-activate ()
  "Activate the GTD system."
  (interactive)
  (codelahoma-gtd-initialize)
  (codelahoma-gtd-setup-states)
  (codelahoma-gtd-setup-capture-templates)
  (codelahoma-gtd-setup-agenda-views)
  (codelahoma-gtd-update-agenda-files)
  (message "GTD system activated"))

;; Auto-activate when org loads
(with-eval-after-load 'org
  (message "GTD: Setting up system...")
  (codelahoma-gtd-activate)
  (codelahoma-gtd-setup-keybindings)
  (message "GTD: System setup complete, keybindings should be available"))

(provide 'codelahoma-gtd)
;;; codelahoma-gtd.el ends here
#+end_src
